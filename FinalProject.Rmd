---
title: "STAT 184 Final Project"
authors: "ProjectTeam 13-3"
date: "April 20, 2021"
output: html_notebook
---

#### Load Packages
```{r}
library(tidyverse)
library(data.table)
```

#### Read in Data and Convert Stat Files to Data Frames
```{r}
# Reads the .csv files
MemFantasy <-
  read.csv("Memorial_Fantasy.csv", header = TRUE)

PGAFantasy <-
  read.csv("PGA_Fantasy.csv", header = TRUE)

SchFantasy <-
  read.csv("Schwab_Fantasy.csv", header = TRUE)

# Reads in the .txt files for further changes
Mem_Start <-
  fread("Memorial_Stats.txt", header = TRUE)

PGA_Start <-
  fread("PGA_Stats.txt", header = TRUE)

Sch_Start <-
  fread("Schwab_Stats.txt", header = TRUE)

# Uses the "Start" to create a new table to tidy the data and add variable names
MemStats <-
  as.data.frame(matrix(Mem_Start$Data, ncol = 9, byrow = TRUE, dimnames = list(c(), c("Position", "Name", "Score", "PUTT", "ARG", "APP", "OTT", "T2G", "Total"))))
MemStats

PGAStats <-
  as.data.frame(matrix(PGA_Start$Data, ncol = 9, byrow = TRUE, dimnames = list(c(), c("Position", "Name", "Score", "PUTT", "ARG", "APP", "OTT", "T2G", "Total"))))
PGAStats

SchStats <-
  as.data.frame(matrix(Sch_Start$Data, ncol = 9, byrow = TRUE, dimnames = list(c(), c("Position", "Name", "Score", "PUTT", "ARG", "APP", "OTT", "T2G", "Total"))))
SchStats
```

#### Join Fantasy and Statistics to Create One Data Frame for Each of Three Tournaments
```{r}
MemFinal <-
  MemStats %>%
  inner_join(MemFantasy, by = "Name")
MemFinal

PGAFinal <-
  PGAStats %>%
  inner_join(PGAFantasy, by = "Name")
PGAFinal

SchFinal <-
  SchStats %>%
  inner_join(SchFantasy, by = "Name")
SchFinal
```

#### Combine the Three Tournament Data Frames to Final Data Frame
###### During this chunk, we create the final data frame, TournamentsFinal, by using rbind to stack the rows from the three different tables. Next we created a new data frame, Scores, and use TournamentsFinal to spread where each person has a row with scores from the three tournaments. After this we needed to create the following variables: rank, top10, madecut, salary, tournplayed, the scores from the three tournaments, and their avg across the tournaments they've played. We used the rank function in order to give each person their rank. We then used that rank variable with an ifelse to add the variable top10 and if they were in the top10 if gave them a "Yes". Madecut uses a grepl with the key "CUT" to filter those who made the cut and those who didn't. Salary uses ifelse functions to determine their salary range. Tournplayed is a simple variable where we used a group_by and a summarise n() to find how many tournaments they played. The scores for each tournament were found earlier in the "Scores" data frame and joined in here. Finally the average is found by using rowMeans over the 3 variables for score from the three tournaments and rounded to 1 decimal. 
```{r}
#Creating the Final Data Frame
TournamentsFinal <-
  rbind(MemFinal, PGAFinal, SchFinal)

#Creating a Scores data frame to easily transform scores and to use for avg later
Scores <- 
  TournamentsFinal %>%
  select(Name, Tournament, Score) %>%
  mutate(Score = gsub("E", 0, Score)) %>%
  mutate(Score = as.numeric(Score)) %>%
  spread(Tournament, Score)
Scores

#Rank
TournamentsFinal <-TournamentsFinal%>%
  group_by(Tournament)%>%
  mutate(rank=rank(desc(Total),ties.method = "min"))

#Top10
TournamentsFinal <-TournamentsFinal%>%
  mutate(top10=ifelse(rank<=10,"Yes","No"))

#MadeCut
TournamentsFinal <- TournamentsFinal %>%
  mutate(MadeCut = ifelse(grepl("CUT", Position), "No", "Yes"))

#Salary
TournamentsFinal <-TournamentsFinal%>%
  mutate(SalaryRange=ifelse(Salary>=6000 & Salary<7000 ,"6000s","7000s"))
TournamentsFinal <-TournamentsFinal%>%
  mutate(SalaryRange=ifelse(Salary>=7000 & Salary<8000 ,"7000s",SalaryRange))
TournamentsFinal <-TournamentsFinal%>%
  mutate(SalaryRange=ifelse(Salary>=8000 & Salary<9000 ,"8000s",SalaryRange))
TournamentsFinal <-TournamentsFinal%>%
  mutate(SalaryRange=ifelse(Salary>=9000 & Salary<10000,"9000s",SalaryRange))
TournamentsFinal <-TournamentsFinal%>%
  mutate(SalaryRange=ifelse(Salary>=10000 & Salary<11000 ,"10000s",SalaryRange))
TournamentsFinal <-TournamentsFinal%>%
  mutate(SalaryRange=ifelse(Salary>=11000 & Salary<12000,"11000s",SalaryRange))
  
#tournplayed
TournamentsFinal <-TournamentsFinal%>%
  group_by(Name)%>%
  mutate(tournplayed=n())
  
#Adding the scores for all the tournaments to each players name
TournamentsFinal <-
  TournamentsFinal %>%
  left_join(Scores, by = "Name")

#Avg
TournamentsFinal$avg <-
  round(rowMeans(TournamentsFinal[, c(19:21)], na.rm = TRUE), 1)

TournamentsFinal
```
### Exploratory Data Analysis (EDA)

#### [Research Question Here]
TODO: 
Create a graph, 
Include several sentences supporting explanation of graph

#### What are the top 3 highest totals from each tournament?

#### Research Question 2A

#### Research Question 2B

#### Research Question 3A

#### Research Question 3B

